# WORKLOG

- Init consolidated repo.
- Implemented eBPF handshake correlation (Task 01):
	- Added TID-keyed cache with 2s TTL, metrics logging every 5s.
	- Metrics: eventsReceived, handshakesEmitted, correlationTimeouts, cacheEvictions, kernel_drops.
	- Output aggregated handshake JSONL to runtime.jsonl.
	- Commands:
		- cd carnot-agent/ebpf-core; make
		- cd go-loader && go build -o bin/carnot-ebpf-loader ./...
		- sudo ./bin/carnot-ebpf-loader -obj ../openssl_handshake.bpf.o -out runtime.jsonl -libssl /lib/x86_64-linux-gnu/libssl.so.3
		- curl -sS https://example.org >$null
	- Expected: runtime.jsonl lines containing pid, tid, sni, groups_offered, success; low kernel_drops & correlationTimeouts.
- Task 01b (Negotiated Group Extraction):
	- Added optional cgo shim (dlopen/dlsym) to call SSL_get_shared_group if exported.
	- Emits negotiated_group in handshake JSON when available.
	- Limitations: only dynamic libssl.so.3, skips statically linked or stripped symbols, pointer validity best-effort, hybrid group IDs placeholder mapping.
- Task 02 (Runtime → CryptoBOM v2.1):
	- Implemented integrations/runtime/ebpf_to_bom.py converting runtime.jsonl handshakes into runtime.bom.json observations.
	- Adds bom_ref, counts unique SNIs, includes success flag & negotiated group.
	- Merge command (example):
		- python integrations/runtime/ebpf_to_bom.py --in artifacts/run1/runtime.jsonl --out artifacts/run1/runtime.bom.json --asset-id host:demo
		- carnot-merge artifacts/run1/static.bom.json artifacts/run1/runtime.bom.json artifacts/run1/aws.bom.json -o artifacts/run1/merged.json
- Task 03 (AWS Inventory Tests & Defaults):
	- Added defaults for untagged assets and tag extraction logic in aws_inventory.py.
	- Implemented retry handling for throttling (exponential backoff).
	- Created moto-based tests for pagination, defaults, throttling resilience.
	- Added GitHub Actions workflow .github/workflows/tests.yml to run pytest.
- Task 04 (OPA Gate Warn → Enforce Prep):
	- Expanded pqc_migration.rego with rules (rsa_min_key_size, legacy_hash_function, missing_hybrid_support, untagged_cloud_key) and remediation messages referencing docs/POLICY_GUIDE.md.
	- Added docs/POLICY_GUIDE.md for remediation guidance.
	- Replaced policy-gate workflow to evaluate policy, upload opa_result.json & opa_summary.json, and comment on PRs.
	- Added workflow_dispatch input 'enforce' (default false) to later enable blocking.
- Task 05 (Cloud Run Attestation API):
	- Added FastAPI service (api/main.py) with POST /attest producing JSON + markdown attestation.
	- Dockerfile & requirements.txt created; deploy script scripts/deploy_cloud_run.sh for gcloud run deploy.
	- Attestation includes HNDL exposure approximation and policy status.
- Task 06 (Site Deploy & Samples):
	- Added static site scaffold at `carnot-site/index.html` (pipeline overview, quick start, roadmap).
	- Published sample attestation artifacts (`docs/samples/sample_attestation.json`, `.md`).
	- Added PCAP walkthrough (`docs/samples/pcap_walkthrough.html`).
	- Added GitHub Actions workflow `.github/workflows/site.yml` to deploy to Cloudflare Pages (project: carnotengine-site).
	- Deployed via Wrangler to Cloudflare Pages project `carnotengine`.
	- Live URL: https://carnotengine.pages.dev (samples accessible under /docs/samples/).
- Task 07 (Stress & Overhead Measurement):
	- Added extended `scripts/stress_test.sh` capturing p95/p99 HTTP latency, throughput, handshake latency percentiles.
	- Computes correlation_failure_rate & kernel_drop_rate from loader metrics.
	- Emits `metrics.json` and markdown summary `docs/OVERHEAD_RESULTS.md`.
	- Windows placeholder run (no eBPF) recorded baseline (p95=~70ms, p99=~563ms @ ~17 rps).
	- Linux run (GitHub Actions run #14) produced handshake metrics & kernel drop stats (artifact: stress-metrics). Repository docs update in progress.
- Added GitHub Actions workflow `.github/workflows/stress.yml` to run full Linux stress test (build eBPF + Go loader, run harness, upload metrics artifacts) so we can collect real handshake correlation & kernel drop metrics without needing local Linux host.
